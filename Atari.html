<canvas id="ctx" height="500" width="500" style="border:1px solid #000000"></canvas>
<script type="text/javascript">

var ctx = document.getElementById('ctx').getContext('2d');
ctx.font = '30px Calibri';

var WIDTH = 500;
var HEIGHT = 500;
var score = 0;
var numOfEnemy = 0;
var player = {
	x:0,
	y:400,
	spdx:30,
	spdY:0,
	height:20,
	width:100,
	color:'blue',
	pressingLeft:false,
	pressingRight:false,
	lives:3,
};

var ball = {
	x:0,
	y:0,
	spdX:-5,
	spdY:-5,
	width:10,
	height:10,
	color:'green',
};
var enemyList = {};

document.onkeydown = function(event)
{
	if (event.keyCode === 37) {
		player.pressingLeft = true;
	}
	else if (event.keyCode === 39) {
		player.pressingRight = true;
	}
}

Enemy = function(width,height,x,y)
{
	var enemy = {};
	enemy.width = width;
	enemy.height = height;
	enemy.x = x;
	enemy.y = y;
	enemy.color = 'orange';
	enemy.id = numOfEnemy++;
	enemy.exists = true;
	enemyList[enemy.id] = enemy;
}

document.onkeyup = function(event)
{
	if (event.keyCode === 37)
		player.pressingLeft = false;
	else if (event.keyCode == 39)
		player.pressingRight = false;
}

drawBar = function()
{
	ctx.save();
	ctx.fillStyle = player.color;
	ctx.fillRect(player.x-player.width/2,player.y-player.height/2,player.width,player.height);
	ctx.restore();
}

updateBarPosition = function()
{
	if (player.pressingLeft)
		player.x -= 10;
	else if (player.pressingRight)
		player.x += 10;
		
	if (player.x > WIDTH - player.width/2)
		player.x = WIDTH - player.width/2;
	if (player.x < player.width/2)
		player.x = player.width/2;
}

updateBar = function()
{
	updateBarPosition();
	drawBar();
}

drawEnemy = function(something)
{
	ctx.save();
	ctx.fillStyle = something.color;
	ctx.fillRect(something.x,something.y,something.width,something.height);
	ctx.restore();
}

drawBall = function(something)
{
	ctx.save();
	ctx.fillStyle = something.color;
	ctx.fillRect(something.x,something.y,something.width,something.height);
	ctx.restore();
}
updateBall = function(something)
{
	something.x += something.spdX;
	something.y += something.spdY;
	if (something.x > WIDTH || something.x < 0)
	{
		something.spdX = -something.spdX;
	}
	if (something.y < 0)
	{
		something.spdY = -something.spdY;
	}
	if (something.y > HEIGHT)
	{
		player.lives--;
		something.spdY = -something.spdY;
		if (player.lives < 1) {
			gameOver();
		}
	}
}

testCollisionRect = function(rect1,rect2)
{
	return ((rect1.x - rect1.width/2 <= rect2.x + rect2.width)
			&& (rect2.x <= rect1.x - rect1.width/2 + rect1.width)
			&& (rect1.y <= rect2.y + rect2.height)
			&& (rect2.y <= rect1.y + rect1.height));
}

testCollisionEntity = function(entity1,entity2) {
	var rect1 = {};
		rect1.x=entity1.x;
		rect1.y=entity1.y;
		rect1.width=entity1.width;
		rect1.height=entity1.height;
	var rect2 = {};
		rect2.x=entity2.x-entity2.width/2;
		rect2.y=entity2.y-entity2.height/2;
		rect2.width=entity2.width;
		rect2.height=entity2.height;
		return testCollisionRect(rect1,rect2);
}

startNewGame = function()
{
	var width = 48;
	var height = 30;
	var y = 2;
	var x = 1;
	length = 0;
	numOfEnemy = 0;
	ball.x = player.x;
	player.lives = 3;
	ball.y = 300;
	player.spdX = -5;
	player.spdY = -5;
	score = 0;
	for(var i=1;i<=70;i++,x = x + width + 2)
	{	
		if (i % 10 === 1 && i != 1) {
			x = 1;
			y = y + height + 2;
		}
		Enemy(width,height,x,y);
	}
}

gameOver = function()
{
	enemyList = {};
	console.log('Score: '+score);
	startNewGame();
}
 
update = function()
{
	ctx.clearRect(0,0,WIDTH,HEIGHT);
	updateBall(ball);
	drawBall(ball);
	for (var key in enemyList)
	{
		drawEnemy(enemyList[key]);
	}
	var isCollision = testCollisionEntity(player,ball);
	if (isCollision)
	{
		ball.spdY = -ball.spdY;
	}
	for(var key in enemyList)
	{
		var isColl = testCollisionEntity(enemyList[key],ball);
		if (isColl)
		{
			delete enemyList[key];
			score += 5;
			ball.spdY = -ball.spdY;
		}
	}
	
	if (score === 350){
			gameOver();
			}
	updateBar();
	ctx.fillText('Score: '+score,10,470);
	ctx.fillText('Lives: '+player.lives,400,470);
}

startNewGame();

setInterval(update,25);
</script>